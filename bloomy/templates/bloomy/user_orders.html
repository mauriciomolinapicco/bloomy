{% extends "bloomy/layout.html" %}
{% load static %}

{% block title %}Novo pedido{% endblock %}

{% block body %}
<div class="bg-gray-600">
    <div class="container mx-auto py-8">
        <h2 class="text-2xl text-white mb-4 text-center">Quadro de demandas</h2>
        
        <div>
            <button id="prev" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full focus:outline-none z-10">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <div id="carousel" class="flex overflow-hidden" style="width: 100%;">
                <div id="inner-carousel" class="flex transition-transform duration-300" style="width: 300%;">
                    {% for order in orders %}
                    <div class="w-1/3 flex items-center justify-center border-2 border-yellow-400 text-white rounded-lg overflow-hidden shadow-lg mx-2 p-6" style="height: 350px;">
                        <div class="text-center">
                            <div class="font-bold text-2xl mb-2">{{ order.name }}</div>
                            <div class="text-l mb-2">Data do pedido: {{ order.date|date:"d/m/Y" }}</div>
                            <br>
                            <p>Status:</p>
                            {% if order.status == 'ENTREGUE' %}
                                <p class="text-yellow-300 text-base font-semibold">{{ order.get_status_display }}</p>
                            {% else %}
                                <p class="text-pink-400 text-base font-semibold">{{ order.get_status_display }}</p>
                            {% endif %}
                            <br>
                            
                            <a href="{% url 'single_order' order.id %}">
                                <button class="bg-pink-600 hover:bg-pink-400 text-white py-2 px-4 rounded mt-2">
                                    Ver Pedido
                                </button>
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <div class="flex items-center">
                        <p class="text-white font-bold">Nao tem pedidos registrados</p> <br>
                        <a href="{% url 'create_order' %}" class="text-white">Clicke aqui e faça seu primero pedido agora!</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <button id="next" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full focus:outline-none z-10">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
            </button>
            <br>
        </div>
    </div>
    <div class="bg-purple-600 ">
        
        <div class="max-w-5xl mx-auto">
        <br>
        <div class="flex items-center text-white text-3xl mb-4">Peças que voce precisa abaixar</div>

        <div class="flex">
            <div class="w-full">
                <table class="min-w-full">
                    <thead>
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                                Nome da peça
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                                Download expira em
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                                Download
                            </th>
                            
                        </tr>
                        <hr>
                    </thead>
                    <tbody class="">
                        {% for order in completed_orders %}
                        <tr class="py-4">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                                 {{ order.name }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                                {{ order.date }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                {% if order.delivery.file %}
                                    <a href="{{ order.delivery.file.url }}" class="text-white hover:text-blue-800" download>Download do arquivo</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr class="py-4">
                            <td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-white">
                                Nao tem pedidos entregues disponiveis
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="w-1/3 ml-4">
                <img src="{% static 'img/thunder.png' %}" class="w-16 h-auto" alt="">
                <p class="text-white ext-sm">
                    Guardamos as suas 
                    peças por 72 horas, 
                    depois disso ela não 
                    estará mais disponível em 
                    nosso sistema!
                </p>
            </div>
        </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('carousel');
        const innerCarousel = document.getElementById('inner-carousel');
        const prevButton = document.getElementById('prev');
        const nextButton = document.getElementById('next');
        const items = innerCarousel.children;
        const itemsPerPage = 3;
        let currentPage = 0;

        function updateCarousel() {
            const offset = -(currentPage * carousel.clientWidth);
            innerCarousel.style.transform = `translateX(${offset}px)`;
        }

        prevButton.addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                updateCarousel();
            }
        });

        nextButton.addEventListener('click', () => {
            if (currentPage < Math.ceil(items.length / itemsPerPage) - 1) {
                currentPage++;
                updateCarousel();
            }
        });

        updateCarousel();
    });
</script>

{% endblock %}
