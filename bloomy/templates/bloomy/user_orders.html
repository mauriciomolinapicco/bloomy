{% extends "bloomy/layout.html" %}
{% load static %}

{% block title %}Novo pedido{% endblock %}

{% block body %}
<div class="bg-purple-500 grid grid-cols-3">
    <div class="m-16 text-xl text-white">E aí, <b class="text-3xl">{{request.user}}</b></div>
    <div></div>
    <div class="m-16 text-white"><a class="bg-yellow-300 text-gray-700 rounded-full p-6 hover:bg-yellow-200" href="{% url 'create_order' %}">Novo briefing</a></div>
</div>
<div class="bg-gray-600">
    <div class="container mx-auto py-8 block" style="height: 600px;">
        <div class="flex items-center mb-4">
            <h2 class="text-2xl text-white mr-4">Quadro de demandas</h2>
            <img src="../../../static/yellow-thunder.webp" alt="thunder" class="h-12">
        </div>
        
        <div class="relative"> 
            <button id="prev" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full focus:outline-none z-10">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <div id="carousel" class="overflow-hidden">
                <div id="inner-carousel" class="flex transition-transform duration-300"> 
                    {% for order in orders %}
                    <div class="w-full flex-shrink-0" style="width: calc(100% / 3);"> 
                        <div class="border-2 border-yellow-400 text-white rounded-lg overflow-hidden shadow-lg mx-2 p-6" style="height: 350px;">
                            <div class="text-center">
                                <div class="font-bold text-2xl mb-2">{{ order.name }}</div>
                                <div class="text-l mb-2">Data do pedido: {{ order.date|date:"d/m/Y" }}</div>
                                <br>
                                <p>Status:</p>
                                {% if order.status == 'ENTREGUE' %}
                                    <p class="text-yellow-300 text-base font-semibold">{{ order.get_status_display }}</p>
                                {% else %}
                                    <p class="text-pink-400 text-base font-semibold">{{ order.get_status_display }}</p>
                                {% endif %}
                                <br>
                                
                                <a href="{% url 'single_order' order.id %}">
                                    <button class="bg-pink-600 hover:bg-pink-400 text-white py-2 px-4 rounded mt-2">
                                        Ver Pedido
                                    </button>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="flex items-center">
                        <p class="text-white font-bold">Nao tem pedidos registrados</p> <br>
                        <a href="{% url 'create_order' %}" class="text-white">Clicke aqui e faça seu primeiro pedido agora!</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <button id="next" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full focus:outline-none z-10">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div> <!-- Modificado: Fin del contenedor relativo para los botones -->
        <br>
    </div>
    <div class="bg-purple-600 grid grid-cols-6">
        <div class="ml-16 mt-8 col-span-4">
            <p class="flex items-center text-white text-3xl mb-4">Peças que voce precisa abaixar</p> <hr><br>
            <div class="col-span-3">
                <div class="flex">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                                    Nome da peça
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                                    Download expira em
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">
                                    Download
                                </th>
                            </tr>
                            <hr>
                        </thead>
                        <tbody class="">
                            {% for order in completed_orders %}
                            <tr class="py-4">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                                    {{ order.name }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-white">
                                    {{ order.date }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    {% if order.delivery.file %}
                                        <a href="{{ order.delivery.file.url }}" class="text-white hover:text-blue-800" download>Download do arquivo</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr class="py-4">
                                <td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-white">
                                    Nao tem pedidos entregues disponiveis
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-span-2 ml-8 mb-8">
            <div class="w-1/3 ml-4 mt-0">
                <img src="../../../static/pink-thunder.webp" class="mt-8 mb-4 ml-6 h-16" alt="">
                <p class="text-white ext-sm">
                    Guardamos as suas 
                    peças por 72 horas, 
                    depois disso ela não 
                    estará mais disponível em 
                    nosso sistema!
                </p>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('carousel');
        const innerCarousel = document.getElementById('inner-carousel');
        const prevButton = document.getElementById('prev');
        const nextButton = document.getElementById('next');
        const items = innerCarousel.children;
        const itemsPerPage = 3;
        let currentPage = 0;

        function updateCarousel() {
            const offset = -(currentPage * carousel.clientWidth);
            innerCarousel.style.transform = `translateX(${offset}px)`;
        }

        prevButton.addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                updateCarousel();
            }
        });

        nextButton.addEventListener('click', () => {
            if (currentPage < Math.ceil(items.length / itemsPerPage) - 1) {
                currentPage++;
                updateCarousel();
            }
        });

        updateCarousel();
    });
</script>

{% endblock %}
